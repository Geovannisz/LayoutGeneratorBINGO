<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Layouts de Antenas BINGO</title>
    <link rel="stylesheet" href="css/styles.css">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <!-- Font Awesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <style>
        /* Estilo adicional para alinhar input e botão de ZIP */
        .download-zip-group {
            display: flex; align-items: center; gap: 10px; margin-top: 20px;
            justify-content: center; flex-wrap: wrap;
        }
        .download-zip-group input[type="text"] {
            padding: 9px; border: 1px solid var(--border-color); border-radius: 4px;
            font-size: 14px; background-color: var(--input-bg-color);
            color: var(--input-text-color); flex-grow: 1; min-width: 200px; max-width: 400px;
        }
        /* Estilos para grupo de download de imagem (agora abaixo do layout) */
        .download-image-controls {
            background-color: var(--card-bg-color); /* Fundo igual ao card */
            padding: 20px;
            margin-top: 20px; /* Espaço acima */
            border-radius: 8px;
            box-shadow: 0 2px 10px var(--shadow-color);
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center; /* Centraliza conteúdo */
        }
        .download-image-controls h3 { margin-bottom: 10px;}
        .download-image-options {
            display: flex; gap: 30px; /* Mais espaço entre grupos */
            flex-wrap: wrap; align-items: flex-start; /* Alinha início */
            justify-content: center; /* Centraliza os grupos */
            width: 100%; /* Ocupa largura */
        }
        .download-image-options .option-group { display: flex; flex-direction: column; gap: 5px; }
        .download-image-options .option-group label { font-weight: 500;}
        .download-image-options .radio-group label { display: inline-flex; align-items: center; margin-right: 15px; font-weight: normal;}
        .download-image-options .radio-group input[type="radio"] { margin-right: 5px;}
        .download-image-button-container { text-align: center; margin-top: 10px;} /* Espaço acima do botão */
    </style>
</head>
<body>
    <header>
        <h1>Gerador de Layouts de Antenas BINGO</h1>
        <div class="theme-toggle">
            <label for="dark-mode-toggle">Modo Escuro</label>
            <input type="checkbox" id="dark-mode-toggle">
        </div>
    </header>

    <div class="container">
        <!-- Gerador de Layout -->
        <section class="layout-generator">
            <h2>Gerador de Layout</h2>
            <div class="layout-controls"> <!-- Container para painel e visualização -->
                <div class="control-panel">
                    <div class="form-group">
                        <label for="layout-type">Tipo de Layout:</label>
                        <select id="layout-type">
                            <option value="grid">Grid</option>
                            <option value="spiral">Espiral</option>
                            <option value="ring">Anéis</option>
                            <option value="rhombus">Losango</option>
                            <option value="hex_grid">Grade Hexagonal</option>
                            <option value="phyllotaxis">Phyllotaxis</option>
                            <option value="manual_circular">Circular Manual</option>
                            <option value="random">Aleatório</option>
                        </select>
                    </div>
                    <div id="dynamic-params" class="dynamic-params-container"></div>
                    <div class="form-group">
                        <label for="show-collisions">Mostrar Colisões:</label>
                        <input type="checkbox" id="show-collisions">
                    </div>
                    <div class="button-group">
                        <button id="generate-btn" class="primary">Gerar Layout</button>
                        <button id="random-btn" class="secondary">Gerar Aleatório</button>
                    </div>
                     <!-- Controles de Download de Imagem foram MOVIDOS daqui -->
                </div>
                <div class="visualization">
                    <canvas id="layout-canvas"></canvas>
                    <div class="stats">
                        <div>Tiles: <span id="tile-count">0</span></div>
                        <div>Antenas: <span id="antenna-count">0</span></div>
                    </div>
                    <!-- Div para informações de colisão será criada/atualizada via JS -->
                </div>
            </div> <!-- Fim de .layout-controls -->

             <!-- <<<--- SEÇÃO DE DOWNLOAD DE IMAGEM MOVIDA PARA CÁ (Fora e Abaixo de layout-controls) --->
            <div class="download-image-controls">
                <h3>Baixar Imagem do Layout</h3>
                <div class="download-image-options">
                    <div class="option-group">
                        <label>Tema da Imagem:</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="imageTheme" value="light" checked> Claro
                            </label>
                            <label>
                                <input type="radio" name="imageTheme" value="dark"> Dracula
                            </label>
                        </div>
                    </div>
                    <div class="option-group">
                        <label>Incluir Eixos:</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="imageAxes" value="yes" checked> Sim
                            </label>
                            <label>
                                <input type="radio" name="imageAxes" value="no"> Não
                            </label>
                        </div>
                    </div>
                </div>
                 <div class="download-image-button-container">
                    <button id="download-image-btn" class="primary"><i class="fas fa-camera"></i> Baixar Imagem (PNG)</button>
                </div>
            </div>
             <!-- <<<--- FIM DA SEÇÃO DE DOWNLOAD DE IMAGEM --->

        </section> <!-- Fim de .layout-generator -->


        <!-- Mapa Interativo -->
        <section class="map-container">
            <h2>Mapa Interativo</h2>
            <div class="map-content">
                <div id="map" class="map"></div>
                <div class="map-info">
                    <p>Coordenadas selecionadas: <span id="selected-coords">Nenhuma</span></p>
                    <p>Distância ao BINGO: <span id="distance-to-bingo">0 km</span></p>
                    <p>Distância do cursor ao BINGO: <span id="dynamic-distance">0 km</span></p>
                    <p>Clique no mapa para adicionar uma localização ou escolha um arranjo existente:</p>
                    <div class="form-group">
                        <label for="arranjo-select">Arranjo:</label>
                        <select id="arranjo-select">
                            <option value="0">Selecione um arranjo</option>
                        </select>
                    </div>
                    <div id="coordinates-list" class="coordinates-list"></div>
                </div>
            </div>
        </section>

        <!-- Exportação -->
        <section class="export-container">
            <h2>Exportação (Estrutura OSKAR)</h2>
            <div class="export-fields">
                 <div class="export-field">
                    <label for="export-layout-wgs84">layout_wgs84.txt (Estações WGS84):</label>
                    <textarea id="export-layout-wgs84" readonly title="Coordenadas WGS84 das estações selecionadas no mapa"></textarea>
                </div>
                 <div class="export-field">
                    <label for="export-position">position.txt (BINGO Central WGS84):</label>
                    <textarea id="export-position" readonly title="Coordenadas WGS84 fixas do BINGO"></textarea>
                </div>
                 <div class="export-field">
                    <label for="export-station-layout">station/layout.txt (Centros Tiles XY):</label>
                    <textarea id="export-station-layout" readonly title="Coordenadas XY relativas dos centros dos tiles na estação"></textarea>
                </div>
                 <div class="export-field">
                    <label for="export-tile-layout">station/tile/layout.txt (Antenas Tile XY):</label>
                    <textarea id="export-tile-layout" readonly title="Coordenadas XY relativas das 64 antenas dentro de um tile"></textarea>
                </div>
            </div>
            <!-- Campo de input e botão de download ZIP agrupados -->
            <div class="download-zip-group">
                <input type="text" id="zip-filename-input" placeholder="Nome do arquivo ZIP (opcional)">
                <button id="download-zip-btn" class="primary"><i class="fas fa-file-archive"></i> Baixar Layout (ZIP)</button>
            </div>
            <p><small>Nota: As coordenadas XY são relativas ao centro da estação ou do tile. Os valores para a altitude estão incorretos.</small></p>
        </section>
    </div>

    <footer>
        <p>Gerador de Layouts de Antenas BINGO - Desenvolvido para visualização e exportação de layouts de antenas</p>
    </footer>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <!-- Bibliotecas JSZip e FileSaver -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>
    <!-- Scripts da aplicação -->
    <script src="js/bingo_layouts.js"></script>
    <script src="js/generator.js"></script>
    <script src="js/map.js"></script>
    <script src="js/export.js"></script>
    <script src="js/main.js"></script>
</body>
</html>